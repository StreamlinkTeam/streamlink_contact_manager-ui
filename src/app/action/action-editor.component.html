<div class="container">
  <mdb-card>
    <mdb-card-header *ngIf="!isSocietyContact()">Actions</mdb-card-header>
    <!--{{projectPos.resourceFullName}} : {{ projectPos.needTitle}} {{projectPos.createdDate}}-->
    <mdb-card-body>
      <div class="row">
        <div class="col border">
          <form #form="ngForm" (ngSubmit)="save(form)" novalidate>

            <div *ngIf="editing" class="form-group">
              <label class="col-form-label">Date de Cr√©ation: </label>
              <input class="form-control-plaintext" name="createdDate" readonly
                     style="width: 70%" type="text"
                     value="{{action.createdDate | date:'long'}}"/>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6 required">
                <label class="col-form-label">Type</label>
                <select #type_input="ngModel" [(ngModel)]="action.type" class="form-control"
                        name="type" required>
                  <option *ngFor="let ff of types" [ngValue]="ff.value">{{ff.label}}</option>
                </select>
                <app-field-error-display
                  [displayError]="form.submitted && type_input.invalid"
                  [model]="type_input">
                </app-field-error-display>

              </div>

              <div class="form-group col-md-6">
                <label class="col-form-label">Date</label>
                <input [(ngModel)]="action.date"
                       class="form-control" name="date" type="datetime-local"/>
              </div>
            </div>

            <div *ngIf="isSociety()" class="form-group">
              <label>Contact</label> <select #contact_input="ngModel" [(ngModel)]="action.societyContactReference"
                                             class="form-control"
                                             name="societyContactReference" required>
              <option *ngFor="let contact of contacts" [ngValue]="contact.reference">{{contact.firstname}}
                {{contact.lastname}}
              </option>
            </select>
              <app-field-error-display
                [displayError]="form.submitted && contact_input.invalid"
                [model]="contact_input"
                fieldName="Contact">
              </app-field-error-display>

            </div>

            <div class="form-group required">
              <label class="col-form-label">Note</label>
              <textarea #note_input="ngModel" [(ngModel)]="action.note" class="form-control" name="note"
                        required rows="5">

			</textarea>

              <app-field-error-display
                [displayError]="form.submitted && note_input.invalid"
                [model]="note_input">
              </app-field-error-display>
            </div>

            <div class="form-group">
              <button class="btn btn-warning" type="submit">Enregistrer</button>
              <button *ngIf="isDeveloper()" class="btn btn-secondary" routerLink="/developers"
                      type="reset">Annuler
              </button>
              <button *ngIf="isResource()" class="btn btn-secondary" routerLink="/resources"
                      type="reset">Annuler
              </button>
              <button *ngIf="isSocietyContact()" class="btn btn-secondary"
                      routerLink="/societies/edit/{{societyReference}}/contacts"
                      type="reset">Annuler
              </button>

              <button *ngIf="isSociety()" class="btn btn-secondary" routerLink="/societies"
                      type="reset">Annuler
              </button>

              <button *ngIf="isProject()" class="btn btn-secondary" routerLink="/projects"
                      type="reset">Annuler
              </button>

              <button *ngIf="isNeed()" class="btn btn-secondary" routerLink="/needs"
                      type="reset">Annuler
              </button>

              <button (click)="newAction(form)" *ngIf="editing" class="btn btn-primary"
                      type="button">Nouveau
              </button>
            </div>

            <table *ngIf="actions?.length > 0"
                   class="table table-striped table-sm">
              <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Type</th>
                <th scope="col">Note</th>
                <th scope="col">Responsable</th>
                <th *ngIf="isSociety()" scope="col">Contact</th>
                <th scope="col">Date</th>
                <th scope="col"></th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let act of actions; let i=index">
                <td>{{i + 1}}</td>
                <td>
                  <app-custom-enum-render [value]="act.type"></app-custom-enum-render>

                </td>
                <td>{{act.note}}</td>
                <td>{{act.responsibleFullName}}</td>
                <td *ngIf="isSociety()">{{act.societyContactFullName}}</td>
                <td>{{act.date | date:'short'}}</td>
                <td>
                  <button (click)="showAction(i,form)" class="btn btn-sm btn-info fa fa-edit"
                          type="button">
                  </button>
                  <button (click)="deleteAction(i)" class="btn btn-sm btn-danger fa fa-trash"
                          type="button">
                  </button>
                </td>
              </tr>
              </tbody>
            </table>
          </form>
        </div>
      </div>
    </mdb-card-body>
  </mdb-card>
</div>
